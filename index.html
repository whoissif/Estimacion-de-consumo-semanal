<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimador de Consumo de Aire Acondicionado</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>üìä Estimador de Consumo de Aire Acondicionado</h1>
            <p class="subtitle">An√°lisis avanzado con pron√≥stico meteorol√≥gico y c√°lculo de costes</p>
        </div>
    </header>

    <div class="container">
        <div class="tabs">
            <div class="tab active" data-tab="data">Datos y Carga</div>
            <div class="tab" data-tab="analysis">An√°lisis y Pron√≥stico</div>
            <div class="tab" data-tab="results">Resultados y Optimizaci√≥n</div>
        </div>

        <div class="tab-content active" id="data-tab">
            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìÇ Cargar Datos de Consumo</div>
                        <div class="card-icon">‚ö°</div>
                    </div>
                    <div class="upload-area" id="drop-area">
                        <div class="upload-icon">‚Üë</div>
                        <p class="upload-text">Arrastra tus archivos Excel aqu√≠ o haz clic para seleccionar</p>
                        <input type="file" id="file-input" accept=".xlsx, .xls" style="display: none;">
                        <button class="upload-button" id="select-button">Seleccionar Archivo</button>
                    </div>
                    <div id="file-info"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üîç Vista Previa de Datos</div>
                        <div class="card-icon">üìä</div>
                    </div>
                    <div class="data-preview">
                        <p>Sube un archivo para ver la vista previa de los datos</p>
                        <div id="data-table"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìà Consumo por Horas</div>
                        <div class="card-icon">‚è±Ô∏è</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="consumption-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="analysis-tab">
            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìç Ubicaci√≥n para Pron√≥stico</div>
                        <div class="card-icon">üåç</div>
                    </div>
                    <div class="control-group">
                        <label for="location">Ubicaci√≥n para el pron√≥stico meteorol√≥gico</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="location" value="San Mart√≠n de Valdeiglesias, Madrid">
                            <button class="secondary" id="reset-location" style="width: auto; padding: 8px 12px; margin-top: 0;">‚Ü∫</button>
                        </div>
                        <small style="color: #7f8c8d; display: block; margin-top: 8px;">
                            Ingresa una ciudad o utiliza la ubicaci√≥n por defecto para mayor precisi√≥n
                        </small>
                    </div>
                    <button class="secondary" id="generate-forecast" style="margin-top: 15px;">Generar Pron√≥stico Meteorol√≥gico</button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üå°Ô∏è Configuraci√≥n de Temperatura</div>
                        <div class="card-icon">üå°Ô∏è</div>
                    </div>
                    <div class="control-group">
                        <label for="target-temp">Temperatura Objetivo Interior (¬∞C)</label>
                        <input type="number" id="target-temp" value="18" min="16" max="24" step="0.5">
                    </div>
                    <div class="control-group">
                        <label for="consumption-factor">Factor de Ajuste por Temperatura</label>
                        <input type="number" id="consumption-factor" value="0.03" min="0.01" max="0.1" step="0.01">
                        <small>Consumo adicional por cada grado de diferencia</small>
                    </div>
                    <div class="control-group">
                        <label for="maintenance-power">Potencia en Modo Mantenimiento (W)</label>
                        <input type="number" id="maintenance-power" value="610" min="300" max="1500" step="10">
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìÖ Pron√≥stico Meteorol√≥gico</div>
                        <div class="card-icon">üå§Ô∏è</div>
                    </div>
                    <div id="weather-loading" class="loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Cargando pron√≥stico meteorol√≥gico...</p>
                    </div>
                    <div id="weather-forecast" class="weather-forecast">
                        <p>Haz clic en "Generar Pron√≥stico Meteorol√≥gico" para ver los datos</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="results-tab">
            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üí∞ C√°lculo de Costes</div>
                        <div class="card-icon">üí∂</div>
                    </div>
                    <div class="control-group">
                        <label for="tariff-type">Tipo de Tarifa</label>
                        <select id="tariff-type">
                            <option value="pvpc">PVPC (Precio Voluntario Peque√±o Consumidor)</option>
                            <option value="fixed">Tarifa Fija</option>
                        </select>
                    </div>
                    <div id="pvpc-prices">
                        <div class="control-group">
                            <label for="valle-price">Precio Valle (22:00-8:00)</label>
                            <input type="number" id="valle-price" value="0.105" step="0.001">
                        </div>
                        <div class="control-group">
                            <label for="llano-price">Precio Llano (8:00-10:00, 14:00-18:00)</label>
                            <input type="number" id="llano-price" value="0.148" step="0.001">
                        </div>
                        <div class="control-group">
                            <label for="punta-price">Precio Punta (10:00-14:00, 18:00-22:00)</label>
                            <input type="number" id="punta-price" value="0.192" step="0.001">
                        </div>
                    </div>
                    <button class="success" id="calculate-cost">Calcular Costes Semanales</button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìä Resultados de la Estimaci√≥n</div>
                        <div class="card-icon">üìà</div>
                    </div>
                    <div id="results-loading" class="loading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Calculando estimaci√≥n semanal...</p>
                    </div>
                    <div class="results" id="estimation-results">
                        <div class="result-row">
                            <span>Consumo Estimado:</span>
                            <span id="weekly-consumption">-- kWh</span>
                        </div>
                        <div class="result-row">
                            <span>Coste Energ√≠a:</span>
                            <span id="energy-cost">-- ‚Ç¨</span>
                        </div>
                        <div class="result-row">
                            <span>Impuesto El√©ctrico:</span>
                            <span id="electric-tax">-- ‚Ç¨</span>
                        </div>
                        <div class="result-row">
                            <span>IVA (21%):</span>
                            <span id="iva-cost">-- ‚Ç¨</span>
                        </div>
                        <div class="result-row">
                            <span><strong>Coste Total Semanal:</strong></span>
                            <span id="total-cost"><strong>-- ‚Ç¨</strong></span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üí° Recomendaciones de Optimizaci√≥n</div>
                        <div class="card-icon">üí°</div>
                    </div>
                    <div id="optimization-tips">
                        <ul>
                            <li>Sube la temperatura 1¬∞C para ahorrar hasta un 8% en consumo</li>
                            <li>Programa temperaturas m√°s bajas durante horas valle (22:00-8:00)</li>
                            <li>Usa el modo eco cuando no haya ocupaci√≥n prolongada</li>
                            <li>Mant√©n los filtros limpios para mejorar la eficiencia en un 15%</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <div class="card-title">üìà Gr√°fico de Consumo Estimado por D√≠a</div>
                    <div class="card-icon">üìä</div>
                </div>
                <div class="chart-container">
                    <canvas id="weekly-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Estimador de Consumo de Aire Acondicionado ‚Ä¢ Datos actualizados a Noviembre 2025</p>
            <p>Nota: Los c√°lculos son estimaciones basadas en los datos proporcionados y pron√≥sticos meteorol√≥gicos hist√≥ricos</p>
        </div>
    </footer>

    <div id="notification-container"></div>
    <script src="estimador.js"></script>
</body>
</html>